<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xác nhận đặt lịch</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        h2 { color: #75a6b6; }
        .section { margin-top: 20px; }
        label { font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; }
        button {
            padding: 10px 20px;
            margin: 10px 10px 0 0;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        .confirm-btn { background-color: #75a6b6; color: white; }
        .cancel-btn { background-color: #e8646c; color: white; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        thead {       background: linear-gradient(90deg, #4ca1af, #c4e0e5);
        ; color: white; }
    </style>
</head>
<body>

<h2>Đặt lịch</h2>
<form action="/datLichThanhCong" method="post" th:object="${xacNhan}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <div class="section">
        <h3>THÔNG TIN CÁ NHÂN</h3>
        <label>Họ & tên</label>
        <input type="text" id="hoTen" th:field="*{hoTen}" readonly />
        <label>Số điện thoại</label>
        <input type="text" id="soDienThoai" th:field="*{soDienThoai}" readonly />
        <label>Email</label>
        <input type="email" id="email" th:field="*{email}" readonly />

    </div>

    <div class="section">
        <h3>THÔNG TIN CHI TIẾT ĐẶT SÂN</h3>
        <table>
            <thead>
            <tr>
                <th>Ngày</th>
                <th>Thời gian</th>
                <th>Sân</th>
                <th>Giá (đ)</th>
            </tr>
            </thead>
            <tbody id="bookingDetailsBody">
            <!-- Dữ liệu sẽ được đổ vào đây bằng JS -->
            </tbody>
        </table>
        <p><strong>Tổng tiền: </strong><span id="totalPrice">0</span> đ</p>
    </div>

    <!-- Ẩn các input để gửi dữ liệu booking chi tiết lên server -->
    <div id="hiddenInputs"></div>
    <p>Google Maps:</p>
    <iframe src="https://maps.google.com/maps?q=Dan%20Sport%20Center,%20Dong%20Ha&t=&z=15&ie=UTF8&iwloc=&output=embed" width="100%" height="250"></iframe>
    <div class="section">
        <button type="submit" class="confirm-btn">Xác nhận đặt lịch</button>
        <button type="button" class="cancel-btn" onclick="window.history.back()">Huỷ</button>
    </div>
</form>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const bookingList = JSON.parse(localStorage.getItem("chiTietDatLichList")) || [];
        const tbody = document.getElementById("bookingDetailsBody");
        const hiddenInputsDiv = document.getElementById("hiddenInputs");
        let total = 0;

        bookingList.forEach((item, index) => {
            const row = document.createElement("tr");

            // Ngày đặt
            const ngayTd = document.createElement("td");
            ngayTd.innerText = item.date || "";
            row.appendChild(ngayTd);

            // Thời gian
            const timeTd = document.createElement("td");
            timeTd.innerText = item.time || "";
            row.appendChild(timeTd);

            // Tên sân
            const courtTd = document.createElement("td");
            courtTd.innerText = item.court || "";
            row.appendChild(courtTd);

            // Giá
            const priceTd = document.createElement("td");
            priceTd.innerText = item.price ? Number(item.price).toLocaleString('vi-VN') : "0";
            row.appendChild(priceTd);

            tbody.appendChild(row);

            total += Number(item.price) || 0;

            // Tạo input ẩn gửi lên server
            // Giả sử model xác nhận có List<ChiTietDatLich> chiTietDatLichList,
            // ChiTietDatLich có các trường ngayDat, thoiGian, tenSan, gia
            const prefix = `chiTietDatLichList[${index}]`;

            hiddenInputsDiv.innerHTML += `
        <input type="hidden" name="${prefix}.ngayDat" value="${item.date || ''}" />
        <input type="hidden" name="${prefix}.thoiGian" value="${item.time || ''}" />
        <input type="hidden" name="${prefix}.tenSan" value="${item.court || ''}" />
        <input type="hidden" name="${prefix}.gia" value="${item.price || 0}" />
        <input type="hidden" name="${prefix}.idGiaTheoKhungGio" value="${item.idgia || ''}" />

      `;
        });

        document.getElementById("totalPrice").innerText = total.toLocaleString('vi-VN');
    });
</script>

</body>
</html>